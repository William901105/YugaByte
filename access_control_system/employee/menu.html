<!--
此頁面為員工系統的主選單頁面
功能：
1. 提供主要功能的導航連結（打卡、查看記錄、查詢薪資）
2. 整合 MQTT 即時通知系統
   - 連接到 HiveMQ Broker
   - 訂閱個人異常通知頻道
   - 即時顯示連線狀態
3. 包含登出功能
4. 具備身份驗證檢查（未登入自動導向登入頁）
-->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功能選單</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
</head>
<body>    <div class="container">
        <h1>歡迎使用員工系統</h1>
        <div class="menu-card">
            <div class="menu-item">
                <a href="records.html" class="feature-link">
                    <div class="feature-icon">📋</div>
                    <h3>查看打卡記錄</h3>
                    <p>查詢您的所有打卡記錄</p>
                </a>
            </div>
            <div class="menu-item">
                <a href="salary.html" class="feature-link">
                    <div class="feature-icon">💰</div>
                    <h3>查詢薪資</h3>
                    <p>檢視您的薪資明細</p>
                </a>
            </div>
            <div class="menu-item">
                <a href="clock.html" class="feature-link">
                    <div class="feature-icon">⏰</div>
                    <h3>進行打卡</h3>
                    <p>上班或下班打卡</p>
                </a>
            </div>
        </div>
        <button id="logoutButton" class="logout-button">登出</button>
        <p id="mqttStatus" class="mqtt-status">MQTT 連線失敗，請檢查網路或稍後再試。</p>
    </div>
    <script src="menu.js"></script>

            // 當收到訊息時的處理函數
            client.onMessageArrived = function (message) {
                console.log('收到異常通知:', message.payloadString);
                alert(`異常通知: ${message.payloadString}`);
            };

            // 當連線成功時的處理函數
            client.onConnect = function () {
                console.log('MQTT 連線成功');
                try {
                    client.subscribe(`access_control/alerts/${userId}`, {
                        onSuccess: function () {
                            console.log('訂閱成功');
                        },
                        onFailure: function (error) {
                            console.error('訂閱失敗:', error.errorMessage);
                            document.getElementById('mqttStatus').style.display = 'block';
                        }
                    });
                } catch (err) {
                    console.error('訂閱過程中發生錯誤:', err.message);
                    document.getElementById('mqttStatus').style.display = 'block';
                }
            };

            // 當連線失敗時的處理函數
            client.onConnectionLost = function (responseObject) {
                if (responseObject.errorCode !== 0) {
                    console.error('MQTT 連線中斷:', responseObject.errorMessage);
                    document.getElementById('mqttStatus').style.display = 'block';
                }
            };

            // 連線至 MQTT Broker
            client.connect({
                onSuccess: client.onConnect,
                onFailure: function (error) {
                    console.error('MQTT 連線失敗:', error.errorMessage);
                    document.getElementById('mqttStatus').style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
