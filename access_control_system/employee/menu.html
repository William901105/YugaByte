<!--
æ­¤é é¢ç‚ºå“¡å·¥ç³»çµ±çš„ä¸»é¸å–®é é¢
åŠŸèƒ½ï¼š
1. æä¾›ä¸»è¦åŠŸèƒ½çš„å°èˆªé€£çµï¼ˆæ‰“å¡ã€æŸ¥çœ‹è¨˜éŒ„ã€æŸ¥è©¢è–ªè³‡ï¼‰
2. æ•´åˆ MQTT å³æ™‚é€šçŸ¥ç³»çµ±
   - é€£æ¥åˆ° HiveMQ Broker
   - è¨‚é–±å€‹äººç•°å¸¸é€šçŸ¥é »é“
   - å³æ™‚é¡¯ç¤ºé€£ç·šç‹€æ…‹
3. åŒ…å«ç™»å‡ºåŠŸèƒ½
4. å…·å‚™èº«ä»½é©—è­‰æª¢æŸ¥ï¼ˆæœªç™»å…¥è‡ªå‹•å°å‘ç™»å…¥é ï¼‰
-->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½é¸å–®</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
</head>
<body>    <div class="container">
        <h1>æ­¡è¿ä½¿ç”¨å“¡å·¥ç³»çµ±</h1>
        <div class="menu-card">
            <div class="menu-item">
                <a href="records.html" class="feature-link">
                    <div class="feature-icon">ğŸ“‹</div>
                    <h3>æŸ¥çœ‹æ‰“å¡è¨˜éŒ„</h3>
                    <p>æŸ¥è©¢æ‚¨çš„æ‰€æœ‰æ‰“å¡è¨˜éŒ„</p>
                </a>
            </div>
            <div class="menu-item">
                <a href="salary.html" class="feature-link">
                    <div class="feature-icon">ğŸ’°</div>
                    <h3>æŸ¥è©¢è–ªè³‡</h3>
                    <p>æª¢è¦–æ‚¨çš„è–ªè³‡æ˜ç´°</p>
                </a>
            </div>
            <div class="menu-item">
                <a href="clock.html" class="feature-link">
                    <div class="feature-icon">â°</div>
                    <h3>é€²è¡Œæ‰“å¡</h3>
                    <p>ä¸Šç­æˆ–ä¸‹ç­æ‰“å¡</p>
                </a>
            </div>
        </div>
        <button id="logoutButton" class="logout-button">ç™»å‡º</button>
        <p id="mqttStatus" class="mqtt-status">MQTT é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦ã€‚</p>
    </div>
    <script src="menu.js"></script>

            // ç•¶æ”¶åˆ°è¨Šæ¯æ™‚çš„è™•ç†å‡½æ•¸
            client.onMessageArrived = function (message) {
                console.log('æ”¶åˆ°ç•°å¸¸é€šçŸ¥:', message.payloadString);
                alert(`ç•°å¸¸é€šçŸ¥: ${message.payloadString}`);
            };

            // ç•¶é€£ç·šæˆåŠŸæ™‚çš„è™•ç†å‡½æ•¸
            client.onConnect = function () {
                console.log('MQTT é€£ç·šæˆåŠŸ');
                try {
                    client.subscribe(`access_control/alerts/${userId}`, {
                        onSuccess: function () {
                            console.log('è¨‚é–±æˆåŠŸ');
                        },
                        onFailure: function (error) {
                            console.error('è¨‚é–±å¤±æ•—:', error.errorMessage);
                            document.getElementById('mqttStatus').style.display = 'block';
                        }
                    });
                } catch (err) {
                    console.error('è¨‚é–±éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', err.message);
                    document.getElementById('mqttStatus').style.display = 'block';
                }
            };

            // ç•¶é€£ç·šå¤±æ•—æ™‚çš„è™•ç†å‡½æ•¸
            client.onConnectionLost = function (responseObject) {
                if (responseObject.errorCode !== 0) {
                    console.error('MQTT é€£ç·šä¸­æ–·:', responseObject.errorMessage);
                    document.getElementById('mqttStatus').style.display = 'block';
                }
            };

            // é€£ç·šè‡³ MQTT Broker
            client.connect({
                onSuccess: client.onConnect,
                onFailure: function (error) {
                    console.error('MQTT é€£ç·šå¤±æ•—:', error.errorMessage);
                    document.getElementById('mqttStatus').style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
